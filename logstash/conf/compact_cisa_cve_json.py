#!/usr/bin/env python3

import json
import os
import requests
import pwd
import grp

url = "https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json"
response = requests.get(url)

if response.status_code == 200:
    loaded_json = response.json()
    one_liner_json = json.dumps(loaded_json, separators=(',', ':'))

    output_file_path = os.path.join("/user/share/logstash/", "cveids-oneliner.log")
    with open(output_file_path, 'w') as output_file:
        output_file.write(one_liner_json)

    user_name = 'syslog'
    group_name = 'adm'

    uid = pwd.getpwnam(user_name).pw_uid
    gid = grp.getgrnam(group_name).gr_gid
    os.chown(output_file_path, uid, gid)

    print(one_liner_json)
else:
    print(f"Error downloading JSON data: {response.status_code}")
