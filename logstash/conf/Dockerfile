FROM docker.elastic.co/logstash/logstash:8.6.1

MAINTAINER dcodev1702
ARG DEBIAN_FRONTEND=noninteractive

USER 0
RUN apt-get update && apt upgrade -y && apt-get install -y \
    ca-certificates \
    software-properties-common \
    build-essential \
    python3-dev \
    python3-pip \
    wget \
    vim \
    cron \
    net-tools
        
        
RUN /usr/bin/python3 -m pip install --upgrade pip && \
    /usr/bin/python3 -m pip install requests
    
        
RUN rm -f /usr/share/logstash/pipeline/logstash.conf && \
    mkdir -p /var/log/cisa_cveids && \
    mkdir -p /tmp/logstash && \
    /usr/share/logstash/bin/logstash-plugin install microsoft-sentinel-logstash-output-plugin
    
COPY ../files/cisa_get_cves /etc/cron.d/cisa_get_cves
COPY ../files/cisa_cve_cronjob.sh /usr/share/logstash/cisa_cve_cronjob.sh

#RUN crontab -l | { cat; echo "0 0 */3 * * /usr/bin/python3 /usr/share/logstash/cisa_cve_compact_json.py"; } | crontab -
#CMD cron

USER $CONTAINER_USER_ID
