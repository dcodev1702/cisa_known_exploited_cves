
# CISA Known Exploited Vulnerabilties #
A dockerized solution to ingest CISA's Known Exploited Vulnerabilities (JSON) via Logstash (v8.X) w/ the new Sentinel plugin and using Azure Data Collection Rule (DCR), Data Collection Endpoint (DCE) and a JSON Sample file. <br />
The sample file used is a small subset CISA's file located [here](https://www.cisa.gov/known-exploited-vulnerabilities-catalog). <br /> 

Limited testing has been done.<br />
<br />
The goal of this effort is to provide the user a way of obtaining additional insight and intelligence leveraged from CISA as it relates to known exploited CVE's. <br /> 

See cited resources below for a more detailed explanation.

Cited Resources:
-----------------
[Microsoft: Azure DCR API Tutorial](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/tutorial-logs-ingestion-portal) <br />
[Medium: Azure DCR API Tutorial](https://koosg.medium.com/ingest-dcr-based-custom-logs-in-microsoft-sentinel-with-logstash-f94c79e69b93) <br />


Assumptions:
------------
1. You have required access to an [Azure tenant](https://portal.azure.com)
2. You have administrative access to a supported Linux VM (on premises or in cloud)
3. You're connected to the Internet
4. [Docker](https://get.docker.com/), Git, Python3, [Logstash](https://www.elastic.co/guide/en/logstash/current/installing-logstash.html) w/ new Sentinel plugin is installed: <br />
    + [/usr/share/logstash/bin/logstash-plugin install microsoft-sentinel-logstash-output-plugin] <br />
    
    + Ubuntu/Debian: sudo apt update && sudo apt upgrade -y && sudo apt install python3-dev <br />
    + RedHat/Rocky: sudo dnf update && sudo dnf upgrade -y && sudo dnf install python3-devel <br />
5. Install [docker-compose](https://github.com/dcodev1702/cisa_known_exploited_cves/blob/main/install_docker_compose.sh)
6. You have the required access to build and run Docker containers
7. You can clone or download and unzip this repository


Instructions:
--------------
```console
git clone https://github.com/dcodev1702/cisa_known_exploited_cves.git
```
```console
cd cisa_known_exploited_cves
```


Configure Logstash Sentinel Plugin to use DCE/DCR API
```console 
sudo vi ./logstash/pipeline/cisa-cveids-dcr-sentinel.conf
```
```console 
./tbd
```
```console 
./tbd
```


If you want to delete existing sample JSON files stored in ./tmp do the following
```console
./tbd
```

Post Condition:
----------------
The sample file: e.g. sampleFilexxxxxxxxxx.json will be in $(pwd)/tmp <br />
You can use this file when creating a Custom Log in Log Analytics via DCR API at the KQL transformation stage <br />

Below is the JSON from the sample file stored in ./tmp. Once uploaded to Log Analytrics - Custom Table (DCR) <br />
you can write your KQL to normalize/transform the unstructured data to a structured format to your liking. <br />
See KQL_Apache2_AccessLog_Transformation.txt for an example. <br />
<br />
