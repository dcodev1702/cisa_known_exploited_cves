
# CISA Known Exploited Vulnerabilties & Microsoft Sentinel #
A dockerized solution to ingest CISA's Known Exploited Vulnerabilities (JSON) via Logstash (v8.X) w/ the new Sentinel plugin and using Azure Data Collection Rule (DCR), Data Collection Endpoint (DCE) and a JSON Sample file. <br />
The sample file used is a small subset CISA's file located [here](https://www.cisa.gov/known-exploited-vulnerabilities-catalog). <br /> 

Limited testing has been done.<br />
<br />
The goal of this effort is to provide the user a way of obtaining additional insight and intelligence leveraged from CISA as it relates to known exploited CVE's. <br /> 

See cited resources below for a more detailed explanation.

Cited Resources:
-----------------
[Microsoft: Azure DCR API Tutorial](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/tutorial-logs-ingestion-portal) <br />
[Medium: Azure DCR API Tutorial](https://koosg.medium.com/ingest-dcr-based-custom-logs-in-microsoft-sentinel-with-logstash-f94c79e69b93) <br />


Assumptions:
------------
1. You have required access to an [Azure tenant](https://portal.azure.com)
2. You have administrative access to a supported Linux VM (on premises or in cloud)
3. You're connected to the Internet
4. Install [Docker & Docker Compose](https://github.com/dcodev1702/cisa_known_exploited_cves/blob/main/install_docker.sh), Git, Python3, [Logstash](https://www.elastic.co/guide/en/logstash/current/installing-logstash.html) w/ new Sentinel plugin is installed: <br />
    + [/usr/share/logstash/bin/logstash-plugin install microsoft-sentinel-logstash-output-plugin] <br />
    
    + Ubuntu/Debian: sudo apt update && sudo apt upgrade -y && sudo apt install python3-dev <br />
    + RedHat/Rocky: sudo dnf update && sudo dnf upgrade -y && sudo dnf install python3-devel <br />
5. You have the required access to build and run Docker containers
6. You can clone or download and unzip this repository


Instructions:
--------------
```console
git clone https://github.com/dcodev1702/cisa_known_exploited_cves.git
```
```console
cd cisa_known_exploited_cves
```
## Log into Microsoft Azure <br />
[Commerical Azure Portal](https://portal.azure.com) <br />
[US Government Azure Portal](https://portal.azure.us) <br />
<br />
Create Data Collection Endpoint (DCE) in Azure Monitor <br />
Create Custom Table via Log Analytrics Workspace <br />
  + Select the DCE you just created <br />
  + Use sample json file 'cisa-cveids-json-oneliner-sample.json' for KQL transformation.
  + Write KQL to normalize and transform the data as you desire.
Create App Registration w/ Secret <br />
```console 
sudo vi ./logstash/pipeline/cisa-cveids-dcr-sentinel.conf
```
Configure Logstash Sentinel Plugin to use DCE/DCR API (logstash/pipeline/cisa-cveids-dcr-sentinel.conf) <br />
  + Client App ID
  + Client App Secret
  + Tenant ID
  + Data Collection Endpoint (ingest url)
  + DCR Immutahle ID
  + DCR Stream Name (Custom-YOUR_CUSTOM_TABLE_CL)
Configure IAM in DCR
  + Add Role: Monitoring Metrics Publisher -> Application Registration

<br />

```console 
./tbd
```
```console 
./tbd
```

Post Condition:
----------------
TBD
<br />
